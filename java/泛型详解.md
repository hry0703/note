# Java æ³›å‹è¯¦è§£

## ğŸ“š ç›®å½•

1. [æ³›å‹åŸºç¡€æ¦‚å¿µ](#æ³›å‹åŸºç¡€æ¦‚å¿µ)
2. [æ³›å‹ç±»](#æ³›å‹ç±»)
3. [æ³›å‹æ–¹æ³•](#æ³›å‹æ–¹æ³•)
4. [æ³›å‹æ¥å£](#æ³›å‹æ¥å£)
5. [é€šé…ç¬¦](#é€šé…ç¬¦)
6. [ç±»å‹æ“¦é™¤](#ç±»å‹æ“¦é™¤)
7. [æ³›å‹æœ€ä½³å®è·µ](#æ³›å‹æœ€ä½³å®è·µ)

---

## æ³›å‹åŸºç¡€æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ

**æ³›å‹ï¼ˆGenericsï¼‰**æ˜¯ Java 5 å¼•å…¥çš„ç‰¹æ€§ï¼Œå…è®¸åœ¨å®šä¹‰ç±»ã€æ¥å£å’Œæ–¹æ³•æ—¶ä½¿ç”¨ç±»å‹å‚æ•°ï¼Œä½¿ä»£ç æ›´åŠ çµæ´»å’Œç±»å‹å®‰å…¨ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹ï¼Ÿ

#### é—®é¢˜ï¼šæ²¡æœ‰æ³›å‹æ—¶

```java
// âŒ æ²¡æœ‰æ³›å‹ï¼šéœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå®¹æ˜“å‡ºé”™
List list = new ArrayList();
list.add("å­—ç¬¦ä¸²");
list.add(123);  // å¯ä»¥æ·»åŠ ä»»ä½•ç±»å‹

String str = (String) list.get(0);  // éœ€è¦å¼ºåˆ¶è½¬æ¢
Integer num = (Integer) list.get(1);  // éœ€è¦å¼ºåˆ¶è½¬æ¢

// è¿è¡Œæ—¶å¯èƒ½å‡ºé”™
String wrong = (String) list.get(1);  // ClassCastExceptionï¼
```

#### è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨æ³›å‹

```java
// âœ… ä½¿ç”¨æ³›å‹ï¼šç±»å‹å®‰å…¨ï¼Œä¸éœ€è¦å¼ºåˆ¶è½¬æ¢
List<String> list = new ArrayList<>();
list.add("å­—ç¬¦ä¸²");
// list.add(123);  // ç¼–è¯‘é”™è¯¯ï¼åªèƒ½æ·»åŠ  String

String str = list.get(0);  // ä¸éœ€è¦å¼ºåˆ¶è½¬æ¢ï¼Œè‡ªåŠ¨æ˜¯ String ç±»å‹
```

### æ³›å‹çš„ä¼˜åŠ¿

- âœ… **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯
- âœ… **ä»£ç ç®€æ´**ï¼šä¸éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢
- âœ… **ä»£ç å¤ç”¨**ï¼šåŒä¸€ä¸ªç±»å¯ä»¥å¤„ç†å¤šç§ç±»å‹
- âœ… **æ›´å¥½çš„å¯è¯»æ€§**ï¼šä»£ç æ„å›¾æ›´æ¸…æ™°

---

## æ³›å‹ç±»

### åŸºæœ¬è¯­æ³•

```java
public class ç±»å<T> {
    // T æ˜¯ç±»å‹å‚æ•°ï¼Œå¯ä»¥æ˜¯ä»»ä½•æ ‡è¯†ç¬¦ï¼ˆå¸¸ç”¨ Tã€Eã€Kã€Vï¼‰
    private T data;
    
    public void setData(T data) {
        this.data = data;
    }
    
    public T getData() {
        return data;
    }
}
```

### ç¤ºä¾‹ 1ï¼šç®€å•çš„æ³›å‹ç±»

```java
// å®šä¹‰æ³›å‹ç±»
public class Box<T> {
    private T content;
    
    public void setContent(T content) {
        this.content = content;
    }
    
    public T getContent() {
        return content;
    }
}

// ä½¿ç”¨æ³›å‹ç±»
Box<String> stringBox = new Box<>();
stringBox.setContent("Hello");
String content = stringBox.getContent();  // ç±»å‹æ˜¯ String

Box<Integer> intBox = new Box<>();
intBox.setContent(100);
Integer number = intBox.getContent();  // ç±»å‹æ˜¯ Integer
```

### ç¤ºä¾‹ 2ï¼šå¤šä¸ªç±»å‹å‚æ•°

```java
// å®šä¹‰å¤šä¸ªç±»å‹å‚æ•°çš„æ³›å‹ç±»
public class Pair<K, V> {
    private K key;
    private V value;
    
    public Pair(K key, V value) {
        this.key = key;
        this.value = value;
    }
    
    public K getKey() {
        return key;
    }
    
    public V getValue() {
        return value;
    }
}

// ä½¿ç”¨
Pair<String, Integer> pair = new Pair<>("å¹´é¾„", 25);
String key = pair.getKey();      // String
Integer value = pair.getValue();  // Integer
```

### ç¤ºä¾‹ 3ï¼šæ³›å‹ç±»ç»§æ‰¿

```java
// çˆ¶ç±»
public class GenericBase<T> {
    protected T data;
    
    public void setData(T data) {
        this.data = data;
    }
}

// å­ç±»ï¼šå¯ä»¥æŒ‡å®šå…·ä½“ç±»å‹
public class StringBox extends GenericBase<String> {
    public void print() {
        System.out.println("å­—ç¬¦ä¸²ï¼š" + data);
    }
}

// å­ç±»ï¼šä¹Ÿå¯ä»¥ä¿æŒæ³›å‹
public class GenericBox<T> extends GenericBase<T> {
    public T getData() {
        return data;
    }
}
```

### ç±»å‹å‚æ•°çš„å‘½åçº¦å®š

- **T**ï¼šTypeï¼ˆç±»å‹ï¼‰
- **E**ï¼šElementï¼ˆå…ƒç´ ï¼Œå¸¸ç”¨äºé›†åˆï¼‰
- **K**ï¼šKeyï¼ˆé”®ï¼‰
- **V**ï¼šValueï¼ˆå€¼ï¼‰
- **N**ï¼šNumberï¼ˆæ•°å­—ï¼‰
- **S, U, V**ï¼šç¬¬äºŒã€ç¬¬ä¸‰ã€ç¬¬å››ç±»å‹å‚æ•°

---

## æ³›å‹æ–¹æ³•

### åŸºæœ¬è¯­æ³•

```java
public <T> è¿”å›ç±»å‹ æ–¹æ³•å(T å‚æ•°) {
    // æ–¹æ³•ä½“
}
```

### ç¤ºä¾‹ 1ï¼šç®€å•çš„æ³›å‹æ–¹æ³•

```java
public class GenericMethodDemo {
    // æ³›å‹æ–¹æ³•ï¼šäº¤æ¢æ•°ç»„ä¸­çš„ä¸¤ä¸ªå…ƒç´ 
    public static <T> void swap(T[] array, int i, int j) {
        T temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
    
    // æ³›å‹æ–¹æ³•ï¼šæŸ¥æ‰¾æ•°ç»„ä¸­çš„æœ€å¤§å€¼
    public static <T extends Comparable<T>> T max(T[] array) {
        if (array == null || array.length == 0) {
            return null;
        }
        T max = array[0];
        for (int i = 1; i < array.length; i++) {
            if (array[i].compareTo(max) > 0) {
                max = array[i];
            }
        }
        return max;
    }
}

// ä½¿ç”¨
String[] strings = {"apple", "banana", "cherry"};
GenericMethodDemo.swap(strings, 0, 2);
String max = GenericMethodDemo.max(strings);
```

### ç¤ºä¾‹ 2ï¼šæ³›å‹æ–¹æ³•å’Œæ³›å‹ç±»çš„åŒºåˆ«

```java
public class Example {
    // è¿™æ˜¯æ³›å‹æ–¹æ³•ï¼ˆç±»å‹å‚æ•°åœ¨æ–¹æ³•ä¸Šï¼‰
    public <T> void genericMethod(T data) {
        System.out.println(data);
    }
    
    // è¿™ä¸æ˜¯æ³›å‹æ–¹æ³•ï¼Œä½¿ç”¨çš„æ˜¯ç±»çš„ç±»å‹å‚æ•°
    public void methodUsingClassType(T data) {
        // å¦‚æœç±»æ²¡æœ‰å®šä¹‰ç±»å‹å‚æ•°ï¼Œè¿™é‡Œä¼šç¼–è¯‘é”™è¯¯
    }
}

// æ³›å‹ç±»ä¸­çš„æ–¹æ³•
public class GenericClass<T> {
    // ä½¿ç”¨ç±»çš„ç±»å‹å‚æ•°
    public void method1(T data) {
        // ä½¿ç”¨ç±»çš„ç±»å‹å‚æ•° T
    }
    
    // æ³›å‹æ–¹æ³•ï¼Œæœ‰è‡ªå·±çš„ç±»å‹å‚æ•° E
    public <E> void method2(E data) {
        // ä½¿ç”¨æ–¹æ³•çš„ç±»å‹å‚æ•° E
    }
    
    // æ³›å‹æ–¹æ³•ï¼Œç±»å‹å‚æ•°ä¸ç±»çš„ä¸åŒ
    public <U> void method3(U data) {
        // ä½¿ç”¨æ–¹æ³•çš„ç±»å‹å‚æ•° Uï¼ˆä¸ç±»çš„ T ä¸åŒï¼‰
    }
}
```

### ç¤ºä¾‹ 3ï¼šé™æ€æ³›å‹æ–¹æ³•

```java
public class Utils {
    // é™æ€æ³›å‹æ–¹æ³•
    public static <T> T getFirst(List<T> list) {
        return list.isEmpty() ? null : list.get(0);
    }
    
    // é™æ€æ³›å‹æ–¹æ³•ï¼šæ•°ç»„è½¬åˆ—è¡¨
    public static <T> List<T> arrayToList(T[] array) {
        List<T> list = new ArrayList<>();
        for (T item : array) {
            list.add(item);
        }
        return list;
    }
}

// ä½¿ç”¨
List<String> strings = Arrays.asList("a", "b", "c");
String first = Utils.getFirst(strings);
```

---

## æ³›å‹æ¥å£

### åŸºæœ¬è¯­æ³•

```java
public interface æ¥å£å<T> {
    T method();
}
```

### ç¤ºä¾‹

```java
// å®šä¹‰æ³›å‹æ¥å£
public interface Container<T> {
    void add(T item);
    T get(int index);
    int size();
}

// å®ç°æ³›å‹æ¥å£ï¼šæŒ‡å®šå…·ä½“ç±»å‹
public class StringContainer implements Container<String> {
    private List<String> list = new ArrayList<>();
    
    @Override
    public void add(String item) {
        list.add(item);
    }
    
    @Override
    public String get(int index) {
        return list.get(index);
    }
    
    @Override
    public int size() {
        return list.size();
    }
}

// å®ç°æ³›å‹æ¥å£ï¼šä¿æŒæ³›å‹
public class GenericContainer<T> implements Container<T> {
    private List<T> list = new ArrayList<>();
    
    @Override
    public void add(T item) {
        list.add(item);
    }
    
    @Override
    public T get(int index) {
        return list.get(index);
    }
    
    @Override
    public int size() {
        return list.size();
    }
}
```

---

## é€šé…ç¬¦

### ä»€ä¹ˆæ˜¯é€šé…ç¬¦ï¼Ÿ

é€šé…ç¬¦ï¼ˆWildcardï¼‰ç”¨ `?` è¡¨ç¤ºï¼Œç”¨äºè¡¨ç¤ºæœªçŸ¥ç±»å‹ï¼Œæä¾›æ›´çµæ´»çš„ç±»å‹çº¦æŸã€‚

### 1. æ— ç•Œé€šé…ç¬¦ï¼ˆUnbounded Wildcardï¼‰

`?` è¡¨ç¤ºä»»ä½•ç±»å‹ã€‚

```java
// å¯ä»¥æ¥å—ä»»ä½•ç±»å‹çš„ List
public void printList(List<?> list) {
    for (Object item : list) {
        System.out.println(item);
    }
}

// ä½¿ç”¨
List<String> strings = Arrays.asList("a", "b");
List<Integer> numbers = Arrays.asList(1, 2, 3);
printList(strings);   // âœ… å¯ä»¥
printList(numbers);   // âœ… å¯ä»¥
```

**æ³¨æ„**ï¼šä½¿ç”¨ `?` æ—¶ï¼Œåªèƒ½è¯»å–ï¼Œä¸èƒ½å†™å…¥ï¼ˆé™¤äº† nullï¼‰ã€‚

```java
List<?> list = new ArrayList<String>();
// list.add("hello");  // âŒ ç¼–è¯‘é”™è¯¯ï¼ä¸çŸ¥é“å…·ä½“ç±»å‹
list.add(null);        // âœ… å¯ä»¥ï¼Œnull æ˜¯ä»»ä½•ç±»å‹çš„å€¼
Object obj = list.get(0);  // âœ… å¯ä»¥è¯»å–
```

### 2. ä¸Šç•Œé€šé…ç¬¦ï¼ˆUpper Bounded Wildcardï¼‰

`? extends T` è¡¨ç¤º T æˆ–å…¶å­ç±»å‹ã€‚

```java
// å¯ä»¥æ¥å— Number åŠå…¶å­ç±»å‹çš„ List
public void printNumbers(List<? extends Number> list) {
    for (Number num : list) {
        System.out.println(num);
    }
}

// ä½¿ç”¨
List<Integer> integers = Arrays.asList(1, 2, 3);
List<Double> doubles = Arrays.asList(1.1, 2.2, 3.3);
printNumbers(integers);  // âœ… å¯ä»¥ï¼ŒInteger æ˜¯ Number çš„å­ç±»
printNumbers(doubles);   // âœ… å¯ä»¥ï¼ŒDouble æ˜¯ Number çš„å­ç±»
```

**ç‰¹ç‚¹**ï¼š
- âœ… å¯ä»¥è¯»å–ï¼ˆç±»å‹æ˜¯ T æˆ–å…¶å­ç±»ï¼‰
- âŒ ä¸èƒ½å†™å…¥ï¼ˆä¸çŸ¥é“å…·ä½“æ˜¯å“ªä¸ªå­ç±»ï¼‰

```java
List<? extends Number> list = new ArrayList<Integer>();
// list.add(new Integer(1));  // âŒ ç¼–è¯‘é”™è¯¯ï¼
Number num = list.get(0);    // âœ… å¯ä»¥è¯»å–
```

### 3. ä¸‹ç•Œé€šé…ç¬¦ï¼ˆLower Bounded Wildcardï¼‰

`? super T` è¡¨ç¤º T æˆ–å…¶çˆ¶ç±»å‹ã€‚

```java
// å¯ä»¥æ¥å— Integer åŠå…¶çˆ¶ç±»å‹çš„ List
public void addNumbers(List<? super Integer> list) {
    list.add(1);
    list.add(2);
    list.add(3);
}

// ä½¿ç”¨
List<Number> numbers = new ArrayList<>();
List<Object> objects = new ArrayList<>();
addNumbers(numbers);  // âœ… å¯ä»¥ï¼ŒNumber æ˜¯ Integer çš„çˆ¶ç±»
addNumbers(objects);  // âœ… å¯ä»¥ï¼ŒObject æ˜¯ Integer çš„çˆ¶ç±»
```

**ç‰¹ç‚¹**ï¼š
- âœ… å¯ä»¥å†™å…¥ï¼ˆç±»å‹æ˜¯ T æˆ–å…¶çˆ¶ç±»ï¼Œå¯ä»¥å®‰å…¨åœ°æ·»åŠ  Tï¼‰
- âŒ è¯»å–æ—¶ç±»å‹ä¸ç¡®å®šï¼ˆåªèƒ½è¯»å–ä¸º Objectï¼‰

```java
List<? super Integer> list = new ArrayList<Number>();
list.add(1);           // âœ… å¯ä»¥å†™å…¥
// Integer num = list.get(0);  // âŒ ç¼–è¯‘é”™è¯¯ï¼
Object obj = list.get(0);      // âœ… å¯ä»¥è¯»å–ä¸º Object
```

### PECS åŸåˆ™

**PECS = Producer Extends, Consumer Super**

- **Producerï¼ˆç”Ÿäº§è€…ï¼‰**ï¼šåªè¯»å–æ•°æ® â†’ ä½¿ç”¨ `? extends T`
- **Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰**ï¼šåªå†™å…¥æ•°æ® â†’ ä½¿ç”¨ `? super T`

```java
// Producerï¼šåªè¯»å–
public void processList(List<? extends Number> list) {
    for (Number num : list) {
        // åªè¯»å–
    }
}

// Consumerï¼šåªå†™å…¥
public void fillList(List<? super Integer> list) {
    list.add(1);
    list.add(2);
    // åªå†™å…¥
}
```

---

## ç±»å‹æ“¦é™¤

### ä»€ä¹ˆæ˜¯ç±»å‹æ“¦é™¤ï¼Ÿ

Java çš„æ³›å‹æ˜¯é€šè¿‡**ç±»å‹æ“¦é™¤ï¼ˆType Erasureï¼‰**å®ç°çš„ï¼Œå³åœ¨ç¼–è¯‘æ—¶æ“¦é™¤æ³›å‹ç±»å‹ä¿¡æ¯ï¼Œè¿è¡Œæ—¶åªä¿ç•™åŸå§‹ç±»å‹ã€‚

### ç±»å‹æ“¦é™¤çš„è§„åˆ™

1. **æ— ç•Œç±»å‹å‚æ•°**ï¼šæ“¦é™¤ä¸º `Object`
2. **æœ‰ç•Œç±»å‹å‚æ•°**ï¼šæ“¦é™¤ä¸ºè¾¹ç•Œç±»å‹

```java
// ç¼–è¯‘å‰
public class Box<T> {
    private T data;
}

// ç¼–è¯‘åï¼ˆç±»å‹æ“¦é™¤ï¼‰
public class Box {
    private Object data;  // T è¢«æ“¦é™¤ä¸º Object
}
```

```java
// ç¼–è¯‘å‰
public class Box<T extends Number> {
    private T data;
}

// ç¼–è¯‘åï¼ˆç±»å‹æ“¦é™¤ï¼‰
public class Box {
    private Number data;  // T è¢«æ“¦é™¤ä¸º Number
}
```

### ç±»å‹æ“¦é™¤çš„å½±å“

#### 1. ä¸èƒ½ä½¿ç”¨ instanceof

```java
// âŒ ç¼–è¯‘é”™è¯¯
if (obj instanceof List<String>) {
    // ...
}
```

#### 2. ä¸èƒ½åˆ›å»ºæ³›å‹æ•°ç»„

```java
// âŒ ç¼–è¯‘é”™è¯¯
List<String>[] array = new List<String>[10];

// âœ… å¯ä»¥è¿™æ ·
List<String>[] array = (List<String>[]) new List[10];
```

#### 3. ä¸èƒ½é‡è½½ï¼ˆç±»å‹æ“¦é™¤åç­¾åç›¸åŒï¼‰

```java
// âŒ ç¼–è¯‘é”™è¯¯ï¼šæ–¹æ³•ç­¾åç›¸åŒ
public void method(List<String> list) {}
public void method(List<Integer> list) {}
```

---

## æ³›å‹æœ€ä½³å®è·µ

### 1. ä½¿ç”¨æœ‰æ„ä¹‰çš„ç±»å‹å‚æ•°å

```java
// âœ… å¥½
public class Box<T> {}
public class Map<K, V> {}
public class List<E> {}

// âŒ ä¸å¥½
public class Box<Type> {}
public class Map<Key, Value> {}
```

### 2. ä¼˜å…ˆä½¿ç”¨æ³›å‹æ–¹æ³•

```java
// âœ… å¥½ï¼šæ³›å‹æ–¹æ³•æ›´çµæ´»
public static <T> T getFirst(List<T> list) {
    return list.isEmpty() ? null : list.get(0);
}

// âš ï¸ å¯ä»¥ï¼šä½†ä¸å¦‚æ³›å‹æ–¹æ³•çµæ´»
public static Object getFirst(List<?> list) {
    return list.isEmpty() ? null : list.get(0);
}
```

### 3. ä½¿ç”¨é€šé…ç¬¦æé«˜çµæ´»æ€§

```java
// âœ… å¥½ï¼šä½¿ç”¨é€šé…ç¬¦
public void printList(List<?> list) {
    for (Object item : list) {
        System.out.println(item);
    }
}

// âš ï¸ å¯ä»¥ï¼šä½†ä¸å¦‚é€šé…ç¬¦çµæ´»
public <T> void printList(List<T> list) {
    for (T item : list) {
        System.out.println(item);
    }
}
```

### 4. éµå¾ª PECS åŸåˆ™

```java
// âœ… å¥½ï¼šProducer ä½¿ç”¨ extends
public void processNumbers(List<? extends Number> list) {
    for (Number num : list) {
        // å¤„ç†
    }
}

// âœ… å¥½ï¼šConsumer ä½¿ç”¨ super
public void addIntegers(List<? super Integer> list) {
    list.add(1);
    list.add(2);
}
```

### 5. é¿å…åŸå§‹ç±»å‹

```java
// âŒ ä¸å¥½ï¼šä½¿ç”¨åŸå§‹ç±»å‹
List list = new ArrayList();

// âœ… å¥½ï¼šä½¿ç”¨æ³›å‹
List<String> list = new ArrayList<>();
```

### 6. ä½¿ç”¨ç±»å‹æ¨æ–­

```java
// âœ… å¥½ï¼šä½¿ç”¨è±å½¢è¿ç®—ç¬¦ï¼ˆJava 7+ï¼‰
List<String> list = new ArrayList<>();

// âš ï¸ å¯ä»¥ï¼šä½†å†—ä½™
List<String> list = new ArrayList<String>();
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒæ¦‚å¿µ

1. **æ³›å‹ç±»**ï¼š`class Box<T> {}`
2. **æ³›å‹æ–¹æ³•**ï¼š`<T> void method(T data) {}`
3. **æ³›å‹æ¥å£**ï¼š`interface Container<T> {}`
4. **é€šé…ç¬¦**ï¼š
   - `?`ï¼šæ— ç•Œé€šé…ç¬¦
   - `? extends T`ï¼šä¸Šç•Œé€šé…ç¬¦
   - `? super T`ï¼šä¸‹ç•Œé€šé…ç¬¦

### å¿«é€Ÿå‚è€ƒ

| åœºæ™¯ | è¯­æ³• | ç¤ºä¾‹ |
|------|------|------|
| æ³›å‹ç±» | `class Box<T>` | `Box<String> box = new Box<>();` |
| æ³›å‹æ–¹æ³• | `<T> void method(T data)` | `Utils.<String>method("hello");` |
| æ— ç•Œé€šé…ç¬¦ | `List<?>` | `void print(List<?> list)` |
| ä¸Šç•Œé€šé…ç¬¦ | `List<? extends Number>` | `void print(List<? extends Number> list)` |
| ä¸‹ç•Œé€šé…ç¬¦ | `List<? super Integer>` | `void add(List<? super Integer> list)` |

### è®°å¿†è¦ç‚¹

- **æ³›å‹ç±»**ï¼šç±»å‹å‚æ•°åœ¨ç±»ä¸Šï¼Œæ•´ä¸ªç±»ä½¿ç”¨
- **æ³›å‹æ–¹æ³•**ï¼šç±»å‹å‚æ•°åœ¨æ–¹æ³•ä¸Šï¼Œåªåœ¨è¯¥æ–¹æ³•ä½¿ç”¨
- **é€šé…ç¬¦**ï¼šæä¾›æ›´çµæ´»çš„ç±»å‹çº¦æŸ
- **PECS**ï¼šProducer Extends, Consumer Super

---

*æœ€åæ›´æ–°ï¼š2024å¹´*
