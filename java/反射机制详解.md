# Java åå°„æœºåˆ¶è¯¦è§£

## ğŸ“š ç›®å½•

1. [åå°„åŸºç¡€æ¦‚å¿µ](#åå°„åŸºç¡€æ¦‚å¿µ)
2. [Class ç±»](#class-ç±»)
3. [è·å–ç±»çš„ä¿¡æ¯](#è·å–ç±»çš„ä¿¡æ¯)
4. [åŠ¨æ€åˆ›å»ºå¯¹è±¡](#åŠ¨æ€åˆ›å»ºå¯¹è±¡)
5. [åŠ¨æ€è°ƒç”¨æ–¹æ³•](#åŠ¨æ€è°ƒç”¨æ–¹æ³•)
6. [è®¿é—®å­—æ®µ](#è®¿é—®å­—æ®µ)
7. [åŠ¨æ€åŠ è½½](#åŠ¨æ€åŠ è½½)
8. [åå°„çš„åº”ç”¨åœºæ™¯](#åå°„çš„åº”ç”¨åœºæ™¯)
9. [åå°„çš„ä¼˜ç¼ºç‚¹](#åå°„çš„ä¼˜ç¼ºç‚¹)

---

## åå°„åŸºç¡€æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ

**åå°„ï¼ˆReflectionï¼‰**æ˜¯ Java æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼š
- è·å–ç±»çš„ä¿¡æ¯ï¼ˆç±»åã€æ–¹æ³•ã€å­—æ®µç­‰ï¼‰
- åˆ›å»ºå¯¹è±¡
- è°ƒç”¨æ–¹æ³•
- è®¿é—®å’Œä¿®æ”¹å­—æ®µ
- åŠ¨æ€åŠ è½½ç±»

### ä¸ºä»€ä¹ˆéœ€è¦åå°„ï¼Ÿ

- âœ… **æ¡†æ¶å¼€å‘**ï¼šSpringã€Hibernate ç­‰æ¡†æ¶å¤§é‡ä½¿ç”¨åå°„
- âœ… **åŠ¨æ€ä»£ç†**ï¼šå®ç° AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰
- âœ… **æ’ä»¶ç³»ç»Ÿ**ï¼šåŠ¨æ€åŠ è½½å’Œè°ƒç”¨æ’ä»¶
- âœ… **å·¥å…·å¼€å‘**ï¼šIDEã€è°ƒè¯•å·¥å…·ç­‰
- âœ… **åºåˆ—åŒ–/ååºåˆ—åŒ–**ï¼šJSONã€XML è½¬æ¢

### åå°„çš„æ ¸å¿ƒç±»

- `Class`ï¼šè¡¨ç¤ºç±»çš„ä¿¡æ¯
- `Constructor`ï¼šè¡¨ç¤ºæ„é€ æ–¹æ³•
- `Method`ï¼šè¡¨ç¤ºæ–¹æ³•
- `Field`ï¼šè¡¨ç¤ºå­—æ®µ
- `Modifier`ï¼šè¡¨ç¤ºä¿®é¥°ç¬¦

---

## Class ç±»

### ä»€ä¹ˆæ˜¯ Class ç±»ï¼Ÿ

`Class` ç±»æ˜¯ Java åå°„çš„æ ¸å¿ƒï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªç±»çš„å…ƒæ•°æ®ï¼ˆç±»çš„ä¿¡æ¯ï¼‰ã€‚

### è·å– Class å¯¹è±¡çš„ä¸‰ç§æ–¹å¼

#### æ–¹å¼ 1ï¼šé€šè¿‡ç±»åè·å–ï¼ˆæ¨èï¼‰

```java
Class<String> clazz = String.class;
```

#### æ–¹å¼ 2ï¼šé€šè¿‡å¯¹è±¡è·å–

```java
String str = "hello";
Class<?> clazz = str.getClass();
```

#### æ–¹å¼ 3ï¼šé€šè¿‡ç±»åå­—ç¬¦ä¸²è·å–ï¼ˆåŠ¨æ€åŠ è½½ï¼‰

```java
Class<?> clazz = Class.forName("java.lang.String");
```

### Class ç±»çš„å¸¸ç”¨æ–¹æ³•

```java
Class<?> clazz = String.class;

// è·å–ç±»å
String name = clazz.getName();           // å®Œæ•´ç±»åï¼šjava.lang.String
String simpleName = clazz.getSimpleName(); // ç®€å•ç±»åï¼šString

// è·å–åŒ…å
Package pkg = clazz.getPackage();
String packageName = pkg.getName();      // java.lang

// è·å–çˆ¶ç±»
Class<?> superClass = clazz.getSuperclass();

// è·å–å®ç°çš„æ¥å£
Class<?>[] interfaces = clazz.getInterfaces();

// è·å–ä¿®é¥°ç¬¦
int modifiers = clazz.getModifiers();
boolean isPublic = Modifier.isPublic(modifiers);
boolean isAbstract = Modifier.isAbstract(modifiers);

// åˆ›å»ºå®ä¾‹
Object instance = clazz.newInstance();  // å·²è¿‡æ—¶ï¼ŒJava 9+
Object instance = clazz.getDeclaredConstructor().newInstance();  // æ¨è
```

---

## è·å–ç±»çš„ä¿¡æ¯

### è·å–æ„é€ æ–¹æ³•

```java
Class<?> clazz = Person.class;

// è·å–æ‰€æœ‰å…¬å…±æ„é€ æ–¹æ³•
Constructor<?>[] publicConstructors = clazz.getConstructors();

// è·å–æ‰€æœ‰æ„é€ æ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰
Constructor<?>[] allConstructors = clazz.getDeclaredConstructors();

// è·å–æŒ‡å®šçš„æ„é€ æ–¹æ³•
Constructor<?> constructor = clazz.getConstructor(String.class, int.class);

// è·å–æ„é€ æ–¹æ³•ä¿¡æ¯
String name = constructor.getName();
Class<?>[] paramTypes = constructor.getParameterTypes();
int modifiers = constructor.getModifiers();
```

### è·å–æ–¹æ³•

```java
Class<?> clazz = Person.class;

// è·å–æ‰€æœ‰å…¬å…±æ–¹æ³•ï¼ˆåŒ…æ‹¬ç»§æ‰¿çš„ï¼‰
Method[] publicMethods = clazz.getMethods();

// è·å–æ‰€æœ‰æ–¹æ³•ï¼ˆä¸åŒ…æ‹¬ç»§æ‰¿çš„ï¼‰
Method[] allMethods = clazz.getDeclaredMethods();

// è·å–æŒ‡å®šçš„å…¬å…±æ–¹æ³•
Method method = clazz.getMethod("getName");

// è·å–æŒ‡å®šçš„æ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰
Method privateMethod = clazz.getDeclaredMethod("privateMethod");

// è·å–æ–¹æ³•ä¿¡æ¯
String methodName = method.getName();
Class<?> returnType = method.getReturnType();
Class<?>[] paramTypes = method.getParameterTypes();
int modifiers = method.getModifiers();
```

### è·å–å­—æ®µ

```java
Class<?> clazz = Person.class;

// è·å–æ‰€æœ‰å…¬å…±å­—æ®µï¼ˆåŒ…æ‹¬ç»§æ‰¿çš„ï¼‰
Field[] publicFields = clazz.getFields();

// è·å–æ‰€æœ‰å­—æ®µï¼ˆä¸åŒ…æ‹¬ç»§æ‰¿çš„ï¼‰
Field[] allFields = clazz.getDeclaredFields();

// è·å–æŒ‡å®šçš„å…¬å…±å­—æ®µ
Field field = clazz.getField("publicField");

// è·å–æŒ‡å®šçš„å­—æ®µï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰
Field privateField = clazz.getDeclaredField("name");

// è·å–å­—æ®µä¿¡æ¯
String fieldName = field.getName();
Class<?> fieldType = field.getType();
int modifiers = field.getModifiers();
```

---

## åŠ¨æ€åˆ›å»ºå¯¹è±¡

### ä½¿ç”¨æ— å‚æ„é€ æ–¹æ³•

```java
Class<?> clazz = Person.class;

// æ–¹å¼ 1ï¼šä½¿ç”¨ newInstance()ï¼ˆå·²è¿‡æ—¶ï¼‰
Person person = (Person) clazz.newInstance();

// æ–¹å¼ 2ï¼šä½¿ç”¨ getDeclaredConstructor().newInstance()ï¼ˆæ¨èï¼‰
Person person = (Person) clazz.getDeclaredConstructor().newInstance();
```

### ä½¿ç”¨æœ‰å‚æ„é€ æ–¹æ³•

```java
Class<?> clazz = Person.class;

// è·å–æœ‰å‚æ„é€ æ–¹æ³•
Constructor<?> constructor = clazz.getConstructor(String.class, int.class);

// åˆ›å»ºå¯¹è±¡
Person person = (Person) constructor.newInstance("å¼ ä¸‰", 25);
```

### å¤„ç†å¼‚å¸¸

```java
try {
    Class<?> clazz = Class.forName("com.example.Person");
    Person person = (Person) clazz.getDeclaredConstructor().newInstance();
} catch (ClassNotFoundException e) {
    System.out.println("ç±»ä¸å­˜åœ¨ï¼š" + e.getMessage());
} catch (NoSuchMethodException e) {
    System.out.println("æ„é€ æ–¹æ³•ä¸å­˜åœ¨ï¼š" + e.getMessage());
} catch (InstantiationException e) {
    System.out.println("æ— æ³•å®ä¾‹åŒ–ï¼š" + e.getMessage());
} catch (IllegalAccessException e) {
    System.out.println("è®¿é—®æƒé™ä¸è¶³ï¼š" + e.getMessage());
} catch (InvocationTargetException e) {
    System.out.println("æ„é€ æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼š" + e.getMessage());
}
```

---

## åŠ¨æ€è°ƒç”¨æ–¹æ³•

### è°ƒç”¨å…¬å…±æ–¹æ³•

```java
Class<?> clazz = Person.class;
Person person = new Person("å¼ ä¸‰", 25);

// è·å–æ–¹æ³•
Method getNameMethod = clazz.getMethod("getName");

// è°ƒç”¨æ–¹æ³•
String name = (String) getNameMethod.invoke(person);
System.out.println("å§“åï¼š" + name);
```

### è°ƒç”¨æœ‰å‚æ•°çš„æ–¹æ³•

```java
Class<?> clazz = Person.class;
Person person = new Person("å¼ ä¸‰", 25);

// è·å–æœ‰å‚æ•°çš„æ–¹æ³•
Method setAgeMethod = clazz.getMethod("setAge", int.class);

// è°ƒç”¨æ–¹æ³•
setAgeMethod.invoke(person, 30);
System.out.println("å¹´é¾„ï¼š" + person.getAge());
```

### è°ƒç”¨é™æ€æ–¹æ³•

```java
Class<?> clazz = Math.class;

// è·å–é™æ€æ–¹æ³•
Method maxMethod = clazz.getMethod("max", int.class, int.class);

// è°ƒç”¨é™æ€æ–¹æ³•ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ä¸º nullï¼‰
int result = (Integer) maxMethod.invoke(null, 10, 20);
System.out.println("æœ€å¤§å€¼ï¼š" + result);
```

### è°ƒç”¨ç§æœ‰æ–¹æ³•

```java
Class<?> clazz = Person.class;
Person person = new Person("å¼ ä¸‰", 25);

// è·å–ç§æœ‰æ–¹æ³•
Method privateMethod = clazz.getDeclaredMethod("privateMethod");

// è®¾ç½®å¯è®¿é—®ï¼ˆç»•è¿‡è®¿é—®æ§åˆ¶ï¼‰
privateMethod.setAccessible(true);

// è°ƒç”¨æ–¹æ³•
privateMethod.invoke(person);
```

---

## è®¿é—®å­—æ®µ

### è¯»å–å­—æ®µå€¼

```java
Class<?> clazz = Person.class;
Person person = new Person("å¼ ä¸‰", 25);

// è·å–å…¬å…±å­—æ®µ
Field nameField = clazz.getField("publicField");
Object value = nameField.get(person);

// è·å–ç§æœ‰å­—æ®µ
Field privateField = clazz.getDeclaredField("name");
privateField.setAccessible(true);  // è®¾ç½®å¯è®¿é—®
Object name = privateField.get(person);
```

### ä¿®æ”¹å­—æ®µå€¼

```java
Class<?> clazz = Person.class;
Person person = new Person("å¼ ä¸‰", 25);

// ä¿®æ”¹å…¬å…±å­—æ®µ
Field publicField = clazz.getField("publicField");
publicField.set(person, "æ–°å€¼");

// ä¿®æ”¹ç§æœ‰å­—æ®µ
Field privateField = clazz.getDeclaredField("name");
privateField.setAccessible(true);
privateField.set(person, "æå››");
```

### è®¿é—®é™æ€å­—æ®µ

```java
Class<?> clazz = System.class;

// è·å–é™æ€å­—æ®µ
Field outField = clazz.getField("out");

// è¯»å–é™æ€å­—æ®µï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ä¸º nullï¼‰
PrintStream out = (PrintStream) outField.get(null);
```

---

## åŠ¨æ€åŠ è½½

### ä»€ä¹ˆæ˜¯åŠ¨æ€åŠ è½½ï¼Ÿ

**åŠ¨æ€åŠ è½½**æ˜¯æŒ‡åœ¨è¿è¡Œæ—¶æ ¹æ®ç±»åå­—ç¬¦ä¸²åŠ è½½ç±»ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ç¡®å®šã€‚

### Class.forName() æ–¹æ³•

```java
// åŠ¨æ€åŠ è½½ç±»
String className = "java.lang.String";
Class<?> clazz = Class.forName(className);

// åˆ›å»ºå¯¹è±¡
Object instance = clazz.getDeclaredConstructor().newInstance();
```

### ä»é…ç½®æ–‡ä»¶åŠ è½½

```java
// é…ç½®æ–‡ä»¶ config.properties
// className=com.example.Person

Properties props = new Properties();
props.load(new FileInputStream("config.properties"));
String className = props.getProperty("className");

// åŠ¨æ€åŠ è½½ç±»
Class<?> clazz = Class.forName(className);
Object instance = clazz.getDeclaredConstructor().newInstance();
```

### åŠ è½½ä¸åŒåŒ…ä¸­çš„ç±»

```java
// åŠ è½½å½“å‰åŒ…ä¸­çš„ç±»
Class<?> clazz1 = Class.forName("com.example.Person");

// åŠ è½½ Java æ ‡å‡†åº“ä¸­çš„ç±»
Class<?> clazz2 = Class.forName("java.util.ArrayList");

// åŠ è½½ç¬¬ä¸‰æ–¹åº“ä¸­çš„ç±»
Class<?> clazz3 = Class.forName("org.springframework.context.ApplicationContext");
```

### å¤„ç†ç±»åŠ è½½å¼‚å¸¸

```java
try {
    Class<?> clazz = Class.forName("com.example.NonExistentClass");
} catch (ClassNotFoundException e) {
    System.out.println("ç±»ä¸å­˜åœ¨ï¼š" + e.getMessage());
    // å¯ä»¥å°è¯•åŠ è½½å…¶ä»–ç±»æˆ–ä½¿ç”¨é»˜è®¤å®ç°
}
```

---

## åå°„çš„åº”ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šæ¡†æ¶å¼€å‘ï¼ˆSpringï¼‰

```java
// Spring æ¡†æ¶ä½¿ç”¨åå°„åˆ›å»º Bean
Class<?> beanClass = Class.forName("com.example.UserService");
Object bean = beanClass.getDeclaredConstructor().newInstance();

// ä½¿ç”¨åå°„æ³¨å…¥ä¾èµ–
Field userDaoField = beanClass.getDeclaredField("userDao");
userDaoField.setAccessible(true);
userDaoField.set(bean, userDao);
```

### åœºæ™¯ 2ï¼šJSON åºåˆ—åŒ–/ååºåˆ—åŒ–

```java
// ä½¿ç”¨åå°„å°†å¯¹è±¡è½¬æ¢ä¸º JSON
public String toJson(Object obj) {
    Class<?> clazz = obj.getClass();
    Field[] fields = clazz.getDeclaredFields();
    
    StringBuilder json = new StringBuilder("{");
    for (Field field : fields) {
        field.setAccessible(true);
        try {
            Object value = field.get(obj);
            json.append("\"").append(field.getName()).append("\":")
                .append(value).append(",");
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
    }
    json.append("}");
    return json.toString();
}
```

### åœºæ™¯ 3ï¼šåŠ¨æ€ä»£ç†

```java
// ä½¿ç”¨åå°„åˆ›å»ºåŠ¨æ€ä»£ç†
InvocationHandler handler = new InvocationHandler() {
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) {
        System.out.println("è°ƒç”¨æ–¹æ³•ï¼š" + method.getName());
        // æ‰§è¡Œå®é™…æ–¹æ³•
        return null;
    }
};

Object proxy = Proxy.newProxyInstance(
    target.getClass().getClassLoader(),
    target.getClass().getInterfaces(),
    handler
);
```

### åœºæ™¯ 4ï¼šæ³¨è§£å¤„ç†

```java
// ä½¿ç”¨åå°„å¤„ç†æ³¨è§£
Class<?> clazz = Person.class;

// æ£€æŸ¥ç±»æ˜¯å¦æœ‰æ³¨è§£
if (clazz.isAnnotationPresent(Entity.class)) {
    Entity entity = clazz.getAnnotation(Entity.class);
    System.out.println("è¡¨åï¼š" + entity.tableName());
}

// æ£€æŸ¥æ–¹æ³•æ˜¯å¦æœ‰æ³¨è§£
Method[] methods = clazz.getDeclaredMethods();
for (Method method : methods) {
    if (method.isAnnotationPresent(Test.class)) {
        // æ‰§è¡Œæµ‹è¯•æ–¹æ³•
        method.invoke(clazz.getDeclaredConstructor().newInstance());
    }
}
```

### åœºæ™¯ 5ï¼šæ’ä»¶ç³»ç»Ÿ

```java
// åŠ¨æ€åŠ è½½æ’ä»¶
public class PluginLoader {
    public void loadPlugin(String pluginClassName) {
        try {
            Class<?> pluginClass = Class.forName(pluginClassName);
            
            // æ£€æŸ¥æ˜¯å¦å®ç°äº† Plugin æ¥å£
            if (Plugin.class.isAssignableFrom(pluginClass)) {
                Plugin plugin = (Plugin) pluginClass.getDeclaredConstructor().newInstance();
                plugin.execute();
            }
        } catch (Exception e) {
            System.err.println("åŠ è½½æ’ä»¶å¤±è´¥ï¼š" + e.getMessage());
        }
    }
}
```

---

## åå°„çš„ä¼˜ç¼ºç‚¹

### ä¼˜ç‚¹

- âœ… **çµæ´»æ€§**ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ“ä½œç±»
- âœ… **æ¡†æ¶æ”¯æŒ**ï¼šæ”¯æŒæ¡†æ¶å¼€å‘
- âœ… **å·¥å…·å¼€å‘**ï¼šæ”¯æŒ IDEã€è°ƒè¯•å·¥å…·ç­‰
- âœ… **è§£è€¦**ï¼šé™ä½ä»£ç è€¦åˆåº¦

### ç¼ºç‚¹

- âŒ **æ€§èƒ½å¼€é”€**ï¼šåå°„æ“ä½œæ¯”ç›´æ¥è°ƒç”¨æ…¢
- âŒ **å®‰å…¨æ€§**ï¼šå¯ä»¥ç»•è¿‡è®¿é—®æ§åˆ¶
- âŒ **å¯è¯»æ€§**ï¼šä»£ç å¯è¯»æ€§è¾ƒå·®
- âŒ **ç»´æŠ¤æ€§**ï¼šç¼–è¯‘æ—¶æ— æ³•æ£€æŸ¥é”™è¯¯

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜ Class å¯¹è±¡**ï¼šé¿å…é‡å¤è·å–
2. **ç¼“å­˜ Method/Field å¯¹è±¡**ï¼šé¿å…é‡å¤æŸ¥æ‰¾
3. **ä½¿ç”¨ setAccessible(true) è°¨æ…**ï¼šä¼šå½±å“æ€§èƒ½
4. **ä¼˜å…ˆä½¿ç”¨ç›´æ¥è°ƒç”¨**ï¼šåªæœ‰åœ¨å¿…è¦æ—¶ä½¿ç”¨åå°„

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒç±»å’Œæ–¹æ³•

| ç±»/æ–¹æ³• | ç”¨é€” |
|---------|------|
| `Class.forName()` | åŠ¨æ€åŠ è½½ç±» |
| `clazz.getDeclaredConstructor()` | è·å–æ„é€ æ–¹æ³• |
| `clazz.getDeclaredMethod()` | è·å–æ–¹æ³• |
| `clazz.getDeclaredField()` | è·å–å­—æ®µ |
| `method.invoke()` | è°ƒç”¨æ–¹æ³• |
| `field.get()/set()` | è¯»å–/è®¾ç½®å­—æ®µå€¼ |
| `setAccessible(true)` | ç»•è¿‡è®¿é—®æ§åˆ¶ |

### ä½¿ç”¨åœºæ™¯

- âœ… æ¡†æ¶å¼€å‘ï¼ˆSpringã€Hibernateï¼‰
- âœ… åŠ¨æ€ä»£ç†
- âœ… åºåˆ—åŒ–/ååºåˆ—åŒ–
- âœ… æ³¨è§£å¤„ç†
- âœ… æ’ä»¶ç³»ç»Ÿ

### æ³¨æ„äº‹é¡¹

- âš ï¸ æ€§èƒ½å¼€é”€è¾ƒå¤§ï¼Œè°¨æ…ä½¿ç”¨
- âš ï¸ å¯ä»¥ç»•è¿‡è®¿é—®æ§åˆ¶ï¼Œæ³¨æ„å®‰å…¨æ€§
- âš ï¸ ç¼–è¯‘æ—¶æ— æ³•æ£€æŸ¥é”™è¯¯ï¼Œè¿è¡Œæ—¶å¯èƒ½å‡ºé”™
- âš ï¸ ä»£ç å¯è¯»æ€§è¾ƒå·®ï¼Œéœ€è¦è‰¯å¥½æ³¨é‡Š

---

*æœ€åæ›´æ–°ï¼š2024å¹´*
