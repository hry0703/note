# Java çº¿ç¨‹å®‰å…¨å’Œå¹¶å‘é›†åˆè¯¦è§£

## ğŸ“š ç›®å½•

1. [çº¿ç¨‹å®‰å…¨åŸºç¡€æ¦‚å¿µ](#çº¿ç¨‹å®‰å…¨åŸºç¡€æ¦‚å¿µ)
2. [ä¼ ç»Ÿé›†åˆçš„çº¿ç¨‹å®‰å…¨é—®é¢˜](#ä¼ ç»Ÿé›†åˆçš„çº¿ç¨‹å®‰å…¨é—®é¢˜)
3. [å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹æ³•](#å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹æ³•)
4. [å¹¶å‘é›†åˆï¼ˆConcurrent Collectionsï¼‰](#å¹¶å‘é›†åˆconcurrent-collections)
5. [å„ç§æ–¹æ¡ˆå¯¹æ¯”](#å„ç§æ–¹æ¡ˆå¯¹æ¯”)
6. [å®é™…åº”ç”¨åœºæ™¯](#å®é™…åº”ç”¨åœºæ™¯)
7. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## çº¿ç¨‹å®‰å…¨åŸºç¡€æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ

**çº¿ç¨‹å®‰å…¨**æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ªèµ„æºæ—¶ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´ã€æ•°æ®ä¸¢å¤±æˆ–å…¶ä»–é”™è¯¯çš„æƒ…å†µã€‚

### ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹å®‰å…¨ï¼Ÿ

åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªé›†åˆï¼Œå¯èƒ½ä¼šå¯¼è‡´ï¼š
- âŒ **æ•°æ®ä¸¢å¤±**ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶æ·»åŠ å…ƒç´ ï¼Œå¯èƒ½åªä¿å­˜ä¸€ä¸ª
- âŒ **æ•°æ®ä¸ä¸€è‡´**ï¼šè¯»å–å’Œå†™å…¥åŒæ—¶è¿›è¡Œï¼Œè¯»å–åˆ°ä¸å®Œæ•´çš„æ•°æ®
- âŒ **ç¨‹åºå´©æºƒ**ï¼šå¹¶å‘ä¿®æ”¹å¯¼è‡´å¼‚å¸¸ï¼ˆå¦‚ `ConcurrentModificationException`ï¼‰

### çº¿ç¨‹ä¸å®‰å…¨çš„ç¤ºä¾‹

```java
// âŒ çº¿ç¨‹ä¸å®‰å…¨çš„ä»£ç 
List<String> list = new ArrayList<>();

// çº¿ç¨‹ 1ï¼šæ·»åŠ å…ƒç´ 
new Thread(() -> {
    for (int i = 0; i < 1000; i++) {
        list.add("å…ƒç´ " + i);
    }
}).start();

// çº¿ç¨‹ 2ï¼šæ·»åŠ å…ƒç´ 
new Thread(() -> {
    for (int i = 0; i < 1000; i++) {
        list.add("å…ƒç´ " + i);
    }
}).start();

// ç»“æœï¼šå¯èƒ½ä¸æ˜¯ 2000 ä¸ªå…ƒç´ ï¼Œå¯èƒ½æ›´å°‘ï¼Œä¹Ÿå¯èƒ½æŠ›å‡ºå¼‚å¸¸
```

---

## ä¼ ç»Ÿé›†åˆçš„çº¿ç¨‹å®‰å…¨é—®é¢˜

### å“ªäº›é›†åˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Ÿ

| é›†åˆç±» | çº¿ç¨‹å®‰å…¨ | è¯´æ˜ |
|--------|---------|------|
| `ArrayList` | âŒ ä¸å®‰å…¨ | å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå‡ºé—®é¢˜ |
| `LinkedList` | âŒ ä¸å®‰å…¨ | å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå‡ºé—®é¢˜ |
| `HashMap` | âŒ ä¸å®‰å…¨ | å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå‡ºé—®é¢˜ |
| `HashSet` | âŒ ä¸å®‰å…¨ | å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå‡ºé—®é¢˜ |
| `TreeMap` | âŒ ä¸å®‰å…¨ | å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå‡ºé—®é¢˜ |
| `TreeSet` | âŒ ä¸å®‰å…¨ | å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå‡ºé—®é¢˜ |
| `Vector` | âœ… å®‰å…¨ | å·²è¿‡æ—¶ï¼Œä¸æ¨èä½¿ç”¨ |
| `Hashtable` | âœ… å®‰å…¨ | å·²è¿‡æ—¶ï¼Œä¸æ¨èä½¿ç”¨ |

### çº¿ç¨‹ä¸å®‰å…¨çš„è¡¨ç°

#### 1. æ•°æ®ä¸¢å¤±

```java
List<Integer> list = new ArrayList<>();

// ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ·»åŠ å…ƒç´ 
Thread t1 = new Thread(() -> {
    for (int i = 0; i < 10000; i++) {
        list.add(i);
    }
});

Thread t2 = new Thread(() -> {
    for (int i = 0; i < 10000; i++) {
        list.add(i);
    }
});

t1.start();
t2.start();
t1.join();
t2.join();

// æœŸæœ›ï¼š20000 ä¸ªå…ƒç´ 
// å®é™…ï¼šå¯èƒ½å°‘äº 20000ï¼ˆæ•°æ®ä¸¢å¤±ï¼‰
System.out.println("å®é™…å¤§å°ï¼š" + list.size());  // å¯èƒ½è¾“å‡ºï¼š15000
```

#### 2. ConcurrentModificationException

```java
List<String> list = new ArrayList<>();
list.add("A");
list.add("B");
list.add("C");

// ä¸€ä¸ªçº¿ç¨‹éå†ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹
Thread t1 = new Thread(() -> {
    for (String item : list) {  // éå†
        System.out.println(item);
        try {
            Thread.sleep(100);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
});

Thread t2 = new Thread(() -> {
    list.add("D");  // ä¿®æ”¹
});

t1.start();
t2.start();

// å¯èƒ½æŠ›å‡ºï¼šConcurrentModificationException
```

---

## å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹æ³•

### æ–¹æ³• 1ï¼šä½¿ç”¨ Collections.synchronizedXXXï¼ˆåŒæ­¥åŒ…è£…ç±»ï¼‰

Java æä¾›äº† `Collections` å·¥å…·ç±»ï¼Œå¯ä»¥å°†æ™®é€šé›†åˆåŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„é›†åˆã€‚

#### 1.1 synchronizedList

```java
import java.util.Collections;
import java.util.List;
import java.util.ArrayList;

// å°† ArrayList åŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„ List
List<String> list = new ArrayList<>();
List<String> syncList = Collections.synchronizedList(list);

// ç°åœ¨å¯ä»¥å®‰å…¨åœ°åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨
syncList.add("å…ƒç´ 1");
syncList.add("å…ƒç´ 2");
```

#### 1.2 synchronizedSet

```java
import java.util.Collections;
import java.util.Set;
import java.util.HashSet;

Set<String> set = new HashSet<>();
Set<String> syncSet = Collections.synchronizedSet(set);

syncSet.add("å…ƒç´ 1");
syncSet.add("å…ƒç´ 2");
```

#### 1.3 synchronizedMap

```java
import java.util.Collections;
import java.util.Map;
import java.util.HashMap;

Map<String, Integer> map = new HashMap<>();
Map<String, Integer> syncMap = Collections.synchronizedMap(map);

syncMap.put("é”®1", 1);
syncMap.put("é”®2", 2);
```

#### 1.4 æ³¨æ„äº‹é¡¹

**âš ï¸ é‡è¦ï¼šéå†æ—¶éœ€è¦æ‰‹åŠ¨åŒæ­¥**

```java
List<String> syncList = Collections.synchronizedList(new ArrayList<>());

// âŒ é”™è¯¯ï¼šéå†æ—¶æ²¡æœ‰åŒæ­¥
for (String item : syncList) {
    // å¯èƒ½æŠ›å‡º ConcurrentModificationException
    System.out.println(item);
}

// âœ… æ­£ç¡®ï¼šéå†æ—¶éœ€è¦æ‰‹åŠ¨åŒæ­¥
synchronized (syncList) {
    for (String item : syncList) {
        System.out.println(item);
    }
}

// âœ… æˆ–è€…ä½¿ç”¨è¿­ä»£å™¨
synchronized (syncList) {
    Iterator<String> iterator = syncList.iterator();
    while (iterator.hasNext()) {
        System.out.println(iterator.next());
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç®€å•æ˜“ç”¨
- âœ… å¯ä»¥åŒ…è£…ä»»ä½•é›†åˆ
- âœ… çº¿ç¨‹å®‰å…¨

**ç¼ºç‚¹**ï¼š
- âŒ æ€§èƒ½è¾ƒå·®ï¼ˆæ‰€æœ‰æ“ä½œéƒ½åŠ é”ï¼‰
- âŒ éå†æ—¶éœ€è¦æ‰‹åŠ¨åŒæ­¥
- âŒ é”çš„ç²’åº¦å¤§ï¼ˆæ•´ä¸ªé›†åˆï¼‰

---

### æ–¹æ³• 2ï¼šä½¿ç”¨å¹¶å‘é›†åˆï¼ˆæ¨èï¼‰

Java 5+ æä¾›äº†ä¸“é—¨çš„å¹¶å‘é›†åˆç±»ï¼Œæ€§èƒ½æ›´å¥½ï¼Œä½¿ç”¨æ›´æ–¹ä¾¿ã€‚

---

## å¹¶å‘é›†åˆï¼ˆConcurrent Collectionsï¼‰

### å¹¶å‘é›†åˆçš„ä¼˜åŠ¿

- âœ… **æ€§èƒ½æ›´å¥½**ï¼šä½¿ç”¨æ›´ç»†ç²’åº¦çš„é”æˆ–æ— é”ç®—æ³•
- âœ… **ä¸éœ€è¦æ‰‹åŠ¨åŒæ­¥**ï¼šéå†æ—¶è‡ªåŠ¨å¤„ç†
- âœ… **ä¸“é—¨ä¸ºå¹¶å‘è®¾è®¡**ï¼šæ›´é€‚åˆå¤šçº¿ç¨‹ç¯å¢ƒ

### ä¸»è¦çš„å¹¶å‘é›†åˆç±»

| å¹¶å‘é›†åˆ | å¯¹åº”çš„æ™®é€šé›†åˆ | ç‰¹ç‚¹ |
|---------|--------------|------|
| `ConcurrentHashMap` | `HashMap` | åˆ†æ®µé”ï¼Œæ€§èƒ½å¥½ |
| `CopyOnWriteArrayList` | `ArrayList` | å†™æ—¶å¤åˆ¶ï¼Œè¯»å¤šå†™å°‘ |
| `CopyOnWriteArraySet` | `HashSet` | å†™æ—¶å¤åˆ¶ï¼Œè¯»å¤šå†™å°‘ |
| `ConcurrentLinkedQueue` | `LinkedList` | æ— é”é˜Ÿåˆ— |
| `BlockingQueue` | - | é˜»å¡é˜Ÿåˆ— |

---

### 1. ConcurrentHashMap

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨åˆ†æ®µé”ï¼ˆJava 8+ ä½¿ç”¨ CAS + synchronizedï¼‰
- æ”¯æŒé«˜å¹¶å‘è¯»å†™
- ä¸éœ€è¦æ‰‹åŠ¨åŒæ­¥éå†æ“ä½œ

**ç¤ºä¾‹**ï¼š

```java
import java.util.concurrent.ConcurrentHashMap;
import java.util.Map;

Map<String, Integer> map = new ConcurrentHashMap<>();

// å¤šçº¿ç¨‹å®‰å…¨åœ°æ·»åŠ å…ƒç´ 
map.put("é”®1", 1);
map.put("é”®2", 2);

// éå†ä¸éœ€è¦æ‰‹åŠ¨åŒæ­¥
for (Map.Entry<String, Integer> entry : map.entrySet()) {
    System.out.println(entry.getKey() + ": " + entry.getValue());
}

// åŸå­æ“ä½œ
map.putIfAbsent("é”®3", 3);  // å¦‚æœä¸å­˜åœ¨åˆ™æ·»åŠ 
map.replace("é”®1", 1, 10);  // å¦‚æœå€¼ç­‰äº 1 åˆ™æ›¿æ¢ä¸º 10
```

**ä¸ HashMap çš„å¯¹æ¯”**ï¼š

```java
// âŒ HashMapï¼šçº¿ç¨‹ä¸å®‰å…¨
Map<String, Integer> hashMap = new HashMap<>();
// å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½å‡ºé—®é¢˜

// âœ… ConcurrentHashMapï¼šçº¿ç¨‹å®‰å…¨
Map<String, Integer> concurrentMap = new ConcurrentHashMap<>();
// å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å®‰å…¨
```

---

### 2. CopyOnWriteArrayList

**ç‰¹ç‚¹**ï¼š
- å†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼‰
- è¯»æ“ä½œä¸éœ€è¦åŠ é”ï¼Œæ€§èƒ½å¥½
- å†™æ“ä½œä¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„ï¼Œé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯
- éå†æ—¶ä¸ä¼šæŠ›å‡º `ConcurrentModificationException`

**åŸç†**ï¼š
- è¯»æ“ä½œï¼šç›´æ¥è¯»å–ï¼Œä¸éœ€è¦åŠ é”
- å†™æ“ä½œï¼šå¤åˆ¶ä¸€ä¸ªæ–°æ•°ç»„ï¼Œåœ¨æ–°æ•°ç»„ä¸Šä¿®æ”¹ï¼Œç„¶åæ›¿æ¢å¼•ç”¨

**ç¤ºä¾‹**ï¼š

```java
import java.util.concurrent.CopyOnWriteArrayList;
import java.util.List;

List<String> list = new CopyOnWriteArrayList<>();

// æ·»åŠ å…ƒç´ 
list.add("å…ƒç´ 1");
list.add("å…ƒç´ 2");

// å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å®‰å…¨
// ä¸€ä¸ªçº¿ç¨‹éå†ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸
Thread t1 = new Thread(() -> {
    for (String item : list) {
        System.out.println(item);
        try {
            Thread.sleep(100);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
});

Thread t2 = new Thread(() -> {
    list.add("å…ƒç´ 3");  // ä¿®æ”¹
});

t1.start();
t2.start();
```

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… è¯»æ“ä½œè¿œå¤šäºå†™æ“ä½œ
- âœ… é›†åˆå¤§å°è¾ƒå°
- âœ… éœ€è¦éå†æ—¶ä¿®æ”¹

**ä¸é€‚ç”¨åœºæ™¯**ï¼š
- âŒ å†™æ“ä½œé¢‘ç¹ï¼ˆæ€§èƒ½å·®ï¼‰
- âŒ é›†åˆå¾ˆå¤§ï¼ˆå¤åˆ¶æˆæœ¬é«˜ï¼‰

---

### 3. CopyOnWriteArraySet

**ç‰¹ç‚¹**ï¼š
- åŸºäº `CopyOnWriteArrayList` å®ç°
- ä¸é‡å¤çš„é›†åˆ
- åŒæ ·é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯

**ç¤ºä¾‹**ï¼š

```java
import java.util.concurrent.CopyOnWriteArraySet;
import java.util.Set;

Set<String> set = new CopyOnWriteArraySet<>();

set.add("å…ƒç´ 1");
set.add("å…ƒç´ 2");
set.add("å…ƒç´ 1");  // é‡å¤ï¼Œä¸ä¼šæ·»åŠ 

// å¤šçº¿ç¨‹å®‰å…¨
```

---

### 4. ConcurrentLinkedQueue

**ç‰¹ç‚¹**ï¼š
- æ— é”é˜Ÿåˆ—ï¼ˆä½¿ç”¨ CAS æ“ä½œï¼‰
- é«˜æ€§èƒ½
- çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—

**ç¤ºä¾‹**ï¼š

```java
import java.util.concurrent.ConcurrentLinkedQueue;
import java.util.Queue;

Queue<String> queue = new ConcurrentLinkedQueue<>();

// æ·»åŠ å…ƒç´ 
queue.offer("å…ƒç´ 1");
queue.offer("å…ƒç´ 2");

// è·å–å¹¶ç§»é™¤å…ƒç´ 
String item = queue.poll();  // "å…ƒç´ 1"

// æŸ¥çœ‹ä½†ä¸ç§»é™¤
String peek = queue.peek();  // "å…ƒç´ 2"
```

---

### 5. BlockingQueueï¼ˆé˜»å¡é˜Ÿåˆ—ï¼‰

**ç‰¹ç‚¹**ï¼š
- å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œå–æ“ä½œä¼šé˜»å¡
- å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œæ·»åŠ æ“ä½œä¼šé˜»å¡
- é€‚åˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼

**ä¸»è¦å®ç°ç±»**ï¼š
- `ArrayBlockingQueue`ï¼šåŸºäºæ•°ç»„çš„æœ‰ç•Œé˜Ÿåˆ—
- `LinkedBlockingQueue`ï¼šåŸºäºé“¾è¡¨çš„æœ‰ç•Œ/æ— ç•Œé˜Ÿåˆ—
- `SynchronousQueue`ï¼šåŒæ­¥é˜Ÿåˆ—

**ç¤ºä¾‹**ï¼š

```java
import java.util.concurrent.BlockingQueue;
import java.util.concurrent.ArrayBlockingQueue;

// åˆ›å»ºå®¹é‡ä¸º 10 çš„é˜»å¡é˜Ÿåˆ—
BlockingQueue<String> queue = new ArrayBlockingQueue<>(10);

// ç”Ÿäº§è€…çº¿ç¨‹
Thread producer = new Thread(() -> {
    try {
        queue.put("äº§å“1");  // å¦‚æœé˜Ÿåˆ—æ»¡ï¼Œä¼šé˜»å¡
        queue.put("äº§å“2");
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
});

// æ¶ˆè´¹è€…çº¿ç¨‹
Thread consumer = new Thread(() -> {
    try {
        String product = queue.take();  // å¦‚æœé˜Ÿåˆ—ç©ºï¼Œä¼šé˜»å¡
        System.out.println("æ¶ˆè´¹ï¼š" + product);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
});

producer.start();
consumer.start();
```

---

## å„ç§æ–¹æ¡ˆå¯¹æ¯”

### æ€§èƒ½å¯¹æ¯”

| æ–¹æ¡ˆ | è¯»æ€§èƒ½ | å†™æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|------|--------|--------|---------|
| `Collections.synchronizedXXX` | æ…¢ï¼ˆå…¨é”ï¼‰ | æ…¢ï¼ˆå…¨é”ï¼‰ | ç®€å•åœºæ™¯ |
| `ConcurrentHashMap` | å¿«ï¼ˆåˆ†æ®µé”/CASï¼‰ | å¿«ï¼ˆåˆ†æ®µé”/CASï¼‰ | é«˜å¹¶å‘è¯»å†™ |
| `CopyOnWriteArrayList` | å¾ˆå¿«ï¼ˆæ— é”è¯»ï¼‰ | æ…¢ï¼ˆå¤åˆ¶æ•°ç»„ï¼‰ | è¯»å¤šå†™å°‘ |
| `Vector` | æ…¢ï¼ˆå…¨é”ï¼‰ | æ…¢ï¼ˆå…¨é”ï¼‰ | ä¸æ¨èä½¿ç”¨ |

### é€‰æ‹©æŒ‡å—

#### 1. Map é›†åˆ

```java
// âŒ ä¸æ¨èï¼šHashMapï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰
Map<String, Integer> map1 = new HashMap<>();

// âš ï¸ å¯ä»¥ï¼šsynchronizedMapï¼ˆæ€§èƒ½ä¸€èˆ¬ï¼‰
Map<String, Integer> map2 = Collections.synchronizedMap(new HashMap<>());

// âœ… æ¨èï¼šConcurrentHashMapï¼ˆæ€§èƒ½å¥½ï¼‰
Map<String, Integer> map3 = new ConcurrentHashMap<>();
```

#### 2. List é›†åˆ

```java
// åœºæ™¯ 1ï¼šè¯»å¤šå†™å°‘
// âœ… æ¨èï¼šCopyOnWriteArrayList
List<String> list1 = new CopyOnWriteArrayList<>();

// åœºæ™¯ 2ï¼šè¯»å†™å‡è¡¡æˆ–å†™å¤š
// âœ… æ¨èï¼šsynchronizedList æˆ–ä½¿ç”¨å¹¶å‘é›†åˆ
List<String> list2 = Collections.synchronizedList(new ArrayList<>());

// åœºæ™¯ 3ï¼šé«˜å¹¶å‘ï¼Œéœ€è¦é«˜æ€§èƒ½
// âœ… æ¨èï¼šæ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©
```

#### 3. Set é›†åˆ

```java
// åœºæ™¯ 1ï¼šè¯»å¤šå†™å°‘
// âœ… æ¨èï¼šCopyOnWriteArraySet
Set<String> set1 = new CopyOnWriteArraySet<>();

// åœºæ™¯ 2ï¼šä¸€èˆ¬åœºæ™¯
// âœ… æ¨èï¼šsynchronizedSet
Set<String> set2 = Collections.synchronizedSet(new HashSet<>());
```

---

## å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šå¤šçº¿ç¨‹è®¡æ•°å™¨

```java
import java.util.concurrent.ConcurrentHashMap;
import java.util.Map;
import java.util.concurrent.atomic.AtomicInteger;

// ä½¿ç”¨ ConcurrentHashMap å®ç°çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨
Map<String, AtomicInteger> counter = new ConcurrentHashMap<>();

// å¤šçº¿ç¨‹å®‰å…¨åœ°å¢åŠ è®¡æ•°
counter.computeIfAbsent("key1", k -> new AtomicInteger(0)).incrementAndGet();
counter.computeIfAbsent("key2", k -> new AtomicInteger(0)).incrementAndGet();
```

### åœºæ™¯ 2ï¼šç¼“å­˜ç³»ç»Ÿ

```java
import java.util.concurrent.ConcurrentHashMap;
import java.util.Map;

// ä½¿ç”¨ ConcurrentHashMap å®ç°çº¿ç¨‹å®‰å…¨çš„ç¼“å­˜
class Cache {
    private Map<String, Object> cache = new ConcurrentHashMap<>();
    
    public void put(String key, Object value) {
        cache.put(key, value);
    }
    
    public Object get(String key) {
        return cache.get(key);
    }
    
    public void remove(String key) {
        cache.remove(key);
    }
}
```

### åœºæ™¯ 3ï¼šäº‹ä»¶ç›‘å¬å™¨åˆ—è¡¨ï¼ˆè¯»å¤šå†™å°‘ï¼‰

```java
import java.util.concurrent.CopyOnWriteArrayList;
import java.util.List;

// ä½¿ç”¨ CopyOnWriteArrayList å­˜å‚¨äº‹ä»¶ç›‘å¬å™¨
class EventManager {
    private List<EventListener> listeners = new CopyOnWriteArrayList<>();
    
    public void addListener(EventListener listener) {
        listeners.add(listener);  // å†™æ“ä½œå°‘
    }
    
    public void fireEvent(Event event) {
        // è¯»æ“ä½œå¤šï¼Œéå†ä¸éœ€è¦åŠ é”
        for (EventListener listener : listeners) {
            listener.onEvent(event);
        }
    }
}
```

### åœºæ™¯ 4ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼

```java
import java.util.concurrent.BlockingQueue;
import java.util.concurrent.ArrayBlockingQueue;

// ä½¿ç”¨ BlockingQueue å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…
class ProducerConsumer {
    private BlockingQueue<String> queue = new ArrayBlockingQueue<>(10);
    
    // ç”Ÿäº§è€…
    public void produce(String item) throws InterruptedException {
        queue.put(item);  // é˜Ÿåˆ—æ»¡æ—¶é˜»å¡
    }
    
    // æ¶ˆè´¹è€…
    public String consume() throws InterruptedException {
        return queue.take();  // é˜Ÿåˆ—ç©ºæ—¶é˜»å¡
    }
}
```

---

## æœ€ä½³å®è·µ

### 1. ä¼˜å…ˆä½¿ç”¨å¹¶å‘é›†åˆ

```java
// âœ… æ¨èï¼šç›´æ¥ä½¿ç”¨å¹¶å‘é›†åˆ
Map<String, Integer> map = new ConcurrentHashMap<>();
List<String> list = new CopyOnWriteArrayList<>();

// âš ï¸ ä¸æ¨èï¼šé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚
Map<String, Integer> map2 = Collections.synchronizedMap(new HashMap<>());
```

### 2. æ ¹æ®åœºæ™¯é€‰æ‹©

- **é«˜å¹¶å‘è¯»å†™** â†’ `ConcurrentHashMap`
- **è¯»å¤šå†™å°‘** â†’ `CopyOnWriteArrayList`ã€`CopyOnWriteArraySet`
- **ç”Ÿäº§è€…-æ¶ˆè´¹è€…** â†’ `BlockingQueue`
- **ç®€å•åœºæ™¯** â†’ `Collections.synchronizedXXX`

### 3. é¿å…ä½¿ç”¨è¿‡æ—¶çš„ç±»

```java
// âŒ ä¸æ¨èï¼šVectorã€Hashtableï¼ˆå·²è¿‡æ—¶ï¼‰
Vector<String> vector = new Vector<>();
Hashtable<String, Integer> hashtable = new Hashtable<>();

// âœ… æ¨èï¼šä½¿ç”¨å¹¶å‘é›†åˆ
List<String> list = new CopyOnWriteArrayList<>();
Map<String, Integer> map = new ConcurrentHashMap<>();
```

### 4. æ³¨æ„éå†æ“ä½œ

```java
// Collections.synchronizedXXXï¼šéå†æ—¶éœ€è¦åŒæ­¥
List<String> syncList = Collections.synchronizedList(new ArrayList<>());
synchronized (syncList) {
    for (String item : syncList) {
        // æ“ä½œ
    }
}

// å¹¶å‘é›†åˆï¼šéå†æ—¶ä¸éœ€è¦åŒæ­¥
List<String> copyOnWriteList = new CopyOnWriteArrayList<>();
for (String item : copyOnWriteList) {
    // æ“ä½œï¼Œè‡ªåŠ¨å®‰å…¨
}
```

### 5. æ€§èƒ½è€ƒè™‘

- **è¯»å¤šå†™å°‘**ï¼šä½¿ç”¨ `CopyOnWriteArrayList`
- **è¯»å†™å‡è¡¡**ï¼šä½¿ç”¨ `ConcurrentHashMap`
- **å†™å¤šè¯»å°‘**ï¼šè€ƒè™‘ä½¿ç”¨ `synchronized` åŒ…è£…ç±»æˆ–é‡æ–°è®¾è®¡

---

## ğŸ“ æ€»ç»“

### å¿«é€Ÿé€‰æ‹©è¡¨

| éœ€æ±‚ | æ¨èæ–¹æ¡ˆ |
|------|---------|
| Map é«˜å¹¶å‘ | `ConcurrentHashMap` |
| List è¯»å¤šå†™å°‘ | `CopyOnWriteArrayList` |
| Set è¯»å¤šå†™å°‘ | `CopyOnWriteArraySet` |
| é˜Ÿåˆ—æ“ä½œ | `BlockingQueue` |
| ç®€å•åœºæ™¯ | `Collections.synchronizedXXX` |

### æ ¸å¿ƒè¦ç‚¹

1. **ä¼ ç»Ÿé›†åˆï¼ˆArrayListã€HashMap ç­‰ï¼‰éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„**
2. **å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¿…é¡»ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆ**
3. **ä¼˜å…ˆä½¿ç”¨å¹¶å‘é›†åˆï¼ˆConcurrentHashMapã€CopyOnWriteArrayList ç­‰ï¼‰**
4. **æ ¹æ®è¯»å†™æ¯”ä¾‹é€‰æ‹©åˆé€‚çš„é›†åˆ**
5. **é¿å…ä½¿ç”¨è¿‡æ—¶çš„ Vector å’Œ Hashtable**

---
