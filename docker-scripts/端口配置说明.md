# 端口配置说明

## 🔌 端口分配方案

为了避免端口冲突，采用了分段式端口分配策略：

### 📊 端口分配表

| 服务 | 端口 | 用途 | 端口段 |
|------|------|------|--------|
| **GitLab** | 18080 | HTTP Web 访问 | 18xxx |
| **GitLab** | 18443 | HTTPS Web 访问 | 18xxx |
| **GitLab** | 12222 | SSH Git 克隆 | 12xxx |
| **Jenkins** | 19080 | HTTP Web 访问 | 19xxx |

### 🎯 **端口选择原则**

1. **避免常用端口**：
   - 8080 (常被 Tomcat、Spring Boot 使用)
   - 3000 (常被 Node.js 开发服务器使用)
   - 5000 (常被 Flask 使用)
   - 9000 (常被 PHP-FPM 使用)

2. **使用高位端口**：
   - 12xxx 系列：Git 相关服务
   - 18xxx 系列：GitLab 服务
   - 19xxx 系列：Jenkins 服务

3. **端口段管理**：
   - 便于记忆和管理
   - 避免随机分配导致的混乱
   - 为未来扩展预留空间

### 🔍 **端口检查命令**

检查端口是否被占用：

```bash
# 检查 GitLab 端口
netstat -tlnp | grep -E ":(18080|18443|12222) "

# 检查 Jenkins 端口  
netstat -tlnp | grep -E ":(19080) "

# 或使用 ss 命令
ss -tlnp | grep -E ":(18080|18443|12222|19080) "
```

### 🌐 **访问地址**

> **💡 提示**：启动脚本会自动检测并显示公网和内网 IP 地址，你也可以手动获取：
> ```bash
> # 获取公网 IP 地址
> curl -s ifconfig.me
> 
> # 获取内网 IP 地址
> ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1' | head -1
> ```

#### GitLab
- **HTTP 本地访问**：http://localhost:18080
- **HTTP 内网访问**：http://内网IP:18080
- **HTTP 公网访问**：http://公网IP:18080
- **HTTPS 本地访问**：https://localhost:18443
- **HTTPS 内网访问**：https://内网IP:18443
- **HTTPS 公网访问**：https://公网IP:18443
- **SSH 内网克隆**：`git clone ssh://git@内网IP:12222/username/repo.git`
- **SSH 公网克隆**：`git clone ssh://git@公网IP:12222/username/repo.git`

#### Jenkins
- **Web 本地访问**：http://localhost:19080
- **Web 内网访问**：http://内网IP:19080
- **Web 公网访问**：http://公网IP:19080

### 🔧 **自定义端口**

如果需要修改端口，编辑对应的 `docker-compose.yml` 文件：

#### GitLab 端口修改
```yaml
# gitlab-scripts/gitlab-docker-compose.yml
ports:
  - '18080:80'     # 修改左侧端口号
  - '18443:443'    # 修改左侧端口号
  - '12222:22'     # 修改左侧端口号
```

#### Jenkins 端口修改
```yaml
# jenkins-scripts/jenkins-docker-compose.yml
ports:
  - '19080:8080'   # 修改左侧端口号
```

### ⚠️ **注意事项**

1. **防火墙设置**：
   - 确保防火墙允许这些端口
   - 云服务器需要在安全组中开放端口

2. **公网访问安全**：
   - 公网访问存在安全风险，建议配置 HTTPS
   - 设置强密码和多因素认证
   - 考虑使用 VPN 或跳板机访问
   - 定期更新系统和应用程序

3. **代理配置**：
   - 如果使用 Nginx 反向代理，需要相应调整配置
   - 确保代理转发到正确的端口

4. **SSL 证书**：
   - HTTPS 端口需要配置相应的 SSL 证书
   - 可以使用 Let's Encrypt 或自签名证书

### 🚀 **生产环境建议**

生产环境中建议：

1. **使用标准端口**：
   - GitLab: 80/443 (通过反向代理)
   - Jenkins: 通过反向代理，不直接暴露

2. **安全配置**：
   - 只在内网开放 Jenkins 端口
   - 使用 VPN 或跳板机访问

3. **域名配置**：
   - gitlab.yourdomain.com
   - jenkins.yourdomain.com

---

*端口配置已优化，避免了常见的端口冲突问题！*
